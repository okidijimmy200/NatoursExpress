Modelling Data and Advanced Mongoose
Lecture 1:
Modelling Data in monogbd
-one of the most important steps in building data intensive apps
is to model data in mongodb

Data Modelling::
--this is the process of taking unstructured data generated by real world
sceenarios and structure it into a logical data model in a databse


ie if we want to design an online shop data model,
initially there is a tonne of unstructured data ie categories,cart,supplies,customers,orders,products
--here we need to restructure data in a logical way reflecting the realworld relationships
products<-->suppliers
  ^
  |         ^
  |          |
  orders <-->cart

  -as a backend eng, this is the place you have to think the most
  bse its not straight forward

  Steps of data Modelling
  --Different types of relationships between data
  --Referencing/Normalization vs embedding/denormalization
  -framework for deciding whether to embedd documents or reference to other documents
  --types of referencing

  --the way we design our data can make or break our application

 A) TYPES OF RELATIONSHIPS BETWEEN DATA
  1:1
-here only one field can only have one value ie
 one movie ------> has one name(movie ---> name)
***not very important in data modeling

  1:MANY
  -very important in data Modelling
-in mongodb, we identify 3 types of one to MANY

1:FEW
ie one movie can win many awards bt jst a few like 3 or 4 not 1000 awards

1:MANY
1 document can reate to hundreds or thousands of documents
ie 1 movie can have 1000 reviews

1:TON(million)
ie logging functionality in our app
--these logs can grow to millions in our documents 
--here the app can grow to almost infinity

MANY:MANY
--here one movie can have mulitple actors bt at the sametime one actor can play
in many movies
-the relationships goes in both directions 

B)
REFERENCING VS EMBEDDING
--if we have 2 related datasets, we can represent it in a referenced/normalized form
or embedd or denormalized form

referenced form:
-we keep the 2 related datasets and all the documents separated
ie 1 movie document and 1 actor document for eah actor
--we make connection btn movie and actor using IDs
--this is called child referencing bse its the parent(movie) wch references child(movie)
--SQL databsae, data is done like this

--In NoSQL databse like mongodb, we denormalize data into a denormalized form by embedding the related document
into the main document
--so we have relavant data abt actors in the movie

so here our app will make fewer queries to the database bse we an get data abt movies and actors at the sametime

--the challenge here is tht we cant query the data on its own so we will need a normalized design for this

--advantages of normalized
**improvement in performance

--disadvanatge
**we need many queries in the database if we are to query both mvies and actors at the same time

--how to decide whether we will normalize or denormalize data
(combine the 3 criteria when deciding)
&&&&--first look at the type of relationships
(how 2 databases are related to one another)
&&&&--data access patterns
(How often data is read and written. Read/write ratio)
&&&&--Data closeness
(how much the data is really related)

ie movie with 100 images
                       ***Embedding                                    ***Referencing
Relationship type:    1-FEW, 1:MANY                                     1:MANY, 1:TON, MANY:MANY

Data Access:          data is mostly read                              Data is updated alot
                      data doenst change quickly                        low(read/write ratio)
                      high read/write ratio                              -if data is updated alot, then we reference
                      --movie + images embedded(not updated)             ie updating the reviews 

Data Closenes:      --if data r closely related                       --we frequently need to query data on their own
                    many users can hv many email address on account
                    so emails r embedded to database

C) TYPES OF REFERENCING
-Child referencing                                        parent referencing                         2-way referencing
**references to related child documents                   --each child doc, we keep                 ---each movie has many actors and many actors and each actor plays in many movies           
r kept in a parent document in an array                   a ref to parent ref                       ---here we keep ref to each actor tht stars in a movie like child referencing & each actor
--challenge is id can grow big wch is bad                 --its more effective thn child              we keep a ref of the movie the actor played in so connected in both directions
--parents nd children r tytly coupled(chld referencing)   --bst used for one to many relationships
--child relationships is used for one to few relationships & one to aton
where array of docs wont grow tht much

--In mongodb, an array shd not be allowed to grow indefinately abovee the 16MB limit
--dont send user 1000 of IDS


Summary:
---strucutre your data to much the ways ur application queries and updates data
--always favour embedding unless otherwise
--1:TON favor referencing instead of embedding
--dont allow arrays to grow indefinately
--use 2-way referencing for MANY:MANY relationships

Lecture 2:
DESIGNING OUR DATA:
--use theory to design the data model of our natours app

THE NATOURS DATA MODEL:::(datasets)
tours
---relationship btn tours and reviews
**1:MANY relationship whereone tour can have mulitple reviews bt one review cqn only be to one tour
**parent referencing here so the reviews end up with tour and user ids

---relationship btn tours and locations
**FEW:FEW where each tour can have different locations 
**each location might also be used in the different tours
**Embedding
--we can implement 2-way referencing(normalizing the locations into its own datasets)
--bt here we will denormalie the ref to tours bse they are related

--relationship btn tour and user:
**this is bse we have tour guides who will be users
**this is a FEW:FEW relationship
**2-ways referencing
users
--relationship btn users and reviews
**one-to-many relationship bse one user can write mulitple reviewa
bt one review can only belong to one user(parent:users, child:reviews)
-we use parent referencing here

reviews



locations


bookings

--there is a relationship btn tours and booking and also users and booking
**one tour can have mulitple bookings bt one booking can only belong to one tour
--same thing with users
--we use parent referencing

Lecture 3:
Modelling locations and Advanced:
--geospatial data in mongodb
--everything related to locations will be in our tours model
--geospatial data r places on earth described using longitude and latitiude co-ordinates
---we can describe lines, polygons, with geospatial data

--import tour.json data

Lecture 4:
Modelling Tour Guides Embedding:
--embedd user docs in tour docs


Lecture 5:
Modelling Tour Guides Child Referencing
--lets connect tours to users using referencing
--here users and tours will be separate entities in our database
-this will contain only the ids of the tour guides and not the actual users

Lecture 6:
Populating tour guides:
--using populate to get access to the referenced tour guides when we query for certain tour
--this makes the data look as if its bn embedded yet we have jst populated it
-this happens in tourzController
-this displays to us information bt doesnot create them in the database
--we can create an object of options in populate
--populate may affect your performance so its best not used alot 

Lecture 7:
Modelling Reviews Parent Referencing:
-implementing the reviews model
-we create a new filein the models called reviews.js

Lecture 8:
Creating and Getting Reviews:
--we will implement an endpoint for getting reviews and also creating new reviews
--creating endpoint for getting reviews and also creating new reviews